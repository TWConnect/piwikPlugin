<script type="text/javascript" src="plugins/SearchMonitor/javascripts/Chart.js"></script>

<script>
    (function ($, require) {
        $(document).ready(function () {
            var startDateObj = new Date(piwik.startDateString);
            var minusDateNum = 30;
            if (piwik.period == 'week') {
                minusDateNum = 140;
            } else if (piwik.period == 'month') {
                startDateObj.setDate(1);
                startDateObj.setMonth((startDateObj.getMonth() + 1) % 12 + 1);
                minusDateNum = 365;
            } else if (piwik.period == 'year') {
                minusDateNum = 1000;
            }
            startDateObj.setDate(startDateObj.getDate() - minusDateNum);
            var startDate = function (startDateObj) {
                var d = new Date(startDateObj),
                        month = '' + (d.getMonth() + 1),
                        day = '' + d.getDate(),
                        year = d.getFullYear();

                if (month.length < 2) month = '0' + month;
                if (day.length < 2) day = '0' + day;

                return [year, month, day].join('-');
            };

            var paceTimeCount = new ajaxHelper();

            paceTimeCount.addParams({
                module: 'API',
                method: 'SearchMonitor.getPaceTimeOnSearchResultDistribution',
                format: 'json',
                date: startDate(startDateObj) + "," + piwik.endDateString
            }, 'get');
            paceTimeCount.setCallback(function (response) {
                var parsedObj = response;
                var labels = parsedObj.map(function (e) {
                    return e['label']
                });
                var count = parsedObj.map(function (e) {
                    return parseFloat(e['Count'])
                });
                var ctx = document.getElementById("pace_time_bar").getContext("2d");
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                type: 'bar',
                                label: 'Search (times)',
                                data: count
                            }
                        ]
                    }
                });
            });
            paceTimeCount.send(false);
        });

    })($, require);
</script>

<div class="card">
    <h2 style="margin:18px;">{{ name }}</h2>
    <div class="card-content">
        <div class="chart-wrapper">
            <canvas id="pace_time_bar"></canvas>
        </div>
    </div>
</div>
